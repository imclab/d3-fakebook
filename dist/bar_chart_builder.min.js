(function(){var t,r={}.hasOwnProperty,n=function(t,n){function e(){this.constructor=t}for(var a in n)r.call(n,a)&&(t[a]=n[a]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};t=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.buildChart=function(){var t,r,n,e,a,i,s,o,u;return e=this.buildData(),a=!1,_(e).each(function(t){return t.values.length?a=!0:void 0}),a?(i=this.findMax(e),s=this.findMin(e),0>i&&0>s&&(o=i,u=s,i=u,s=o),r=this.opts.colors||this.countryColors,this._setColorScale(r,e),this.x0=d3.scale.ordinal().rangeRoundBands([0,this.innerWidth],.1),this.x1=d3.scale.ordinal(),this.y=d3.scale.linear().range([this.innerHeight,0]),this.xAxis=this.createAxis("x",this.x0,"bottom"),this.yAxis=this.createAxis("y",this.y,"left",{size:{major:0-this.innerWidth,minor:0-this.innerWidth,end:0-this.innerWidth}}),n=this.setCountries(this.color,e),t=d3.keys(e[0]).filter(function(t){return"year"!==t&&"values"!==t}),this.x0.domain(e.map(function(t){return t.year})),this.x1.domain(t).rangeRoundBands([0,this.x0.rangeBand()]),this.y.domain([s,i]),setTimeout(function(){return $(".chart-bar").popover({container:"body",html:!0,trigger:"manual",placement:"top"},10)}),this.drawChart(e)):void this.displayNotice("This dataset cannot be rendered.","There is insufficient data for this chart.")},r.prototype.findMin=function(t){var r;return r=d3.min(t,function(t){return d3.min(t.values,function(t){return t.value})}),Math.min(0,r)},r.prototype.findMax=function(t){var r;return r=d3.max(t,function(t){return d3.max(t.values,function(t){return t.value})})},r.prototype.createAxis=function(t,r,n,e){var a,i;return i={count:10,subdivide:!1,padding:10,size:{major:0,minor:0,end:0}},e=_.extend(i,e||{}),a=d3.svg.axis().scale(r).orient(n),t.match(/^y/)&&(a.ticks(e.count).tickSize(e.size.major,e.size.minor,e.size.end).tickPadding(e.padding),this.setTickFormat(a)),a},r.prototype.setCountries=function(t,r){return t.domain().map(function(t){return{name:t,values:r[t]}})},r.prototype.buildData=function(){var t,r,n;return t=this.data,n=_.keys(t),r=_.values(t),_(n).each(function(r){return t[r].values=[],_(t[r]).each(function(n,e){var a;return"year"===e||"values"===e||_(n).isNaN()?void 0:(a={name:e,value:+n,year:+t[r].year},"World"===e?t[r].values.unshift(a):t[r].values.push(a))})}),t},r.prototype.drawChart=function(t){return this.drawAxes(),this.drawBars(t),this.drawLegend(),this.drawTitle()},r.prototype.drawBars=function(t){var r,n;return r=function(t){var r,n;return r=d3.format("n"),n=r(t),"-0"===n&&(n="0"),n},n=this.svg.selectAll(".year").data(t).enter().append("g").attr("class","g").attr("transform",function(t){return function(r){return"translate("+t.x0(r.year)+",0)"}}(this)),n.selectAll("rect").data(function(t){return t.values}).enter().append("rect").attr("class","chart-bar").attr("width",this.x1.rangeBand()).attr("x",function(t){return function(r){return t.x1(r.name)}}(this)).attr("y",function(t){return function(r){return t.y(r.value)}}(this)).attr("title",function(t){return t.name}).attr("height",function(t){return function(r){return t.innerHeight-t.y(r.value)}}(this)).style("fill",function(t){return function(r){return t.color(r.name)}}(this)).attr("data-legend",function(t){return t.name}).attr("data-legend-color",function(t){return function(r){return t.color(r.name)}}(this)).attr("data-toggle","popover").attr("data-content",function(t){return function(n){return'<strong style="color: '+t.color(n.name)+';"> '+r(parseFloat(n.value,10).round2())+" #</strong> "+n.year}}(this)).on("mouseover",function(){return $(this).popover("show")}).on("mouseout",function(){return $(this).popover("hide")})},r.prototype.drawAxes=function(){return this.drawXAxis(),this.drawYAxis()},r.prototype.drawXAxis=function(){return this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.innerHeight+")").call(this.xAxis)},r.prototype.drawYAxis=function(){var t,r;return r=0-this.opts.yLabelOffset||this.margin.left/6,t=this.svg.append("g").attr("class","y axis").call(this.yAxis).append("text").attr("transform","rotate(-90)translate(0, "+r+")").style("text-anchor","middle").attr("class","chart-label chart-label-y-axis"),t.append("tspan").attr("x","-160").attr("y","-4.2em").text(""+_.str.words(this.opts.yLabel,", ")[0]),t.append("tspan").attr("x","-160").attr("y","-3.0em").text(_.str.words(this.opts.yLabel,", ")[1])},r}(ChartBuilder)}).call(this);