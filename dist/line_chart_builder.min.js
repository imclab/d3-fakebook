(function(){var t,n={}.hasOwnProperty,r=function(t,r){function i(){this.constructor=t}for(var e in r)n.call(r,e)&&(t[e]=r[e]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t};t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.buildChart=function(){var t,n,r,i,e,a,o,s;return t=this.buildData(),i=t[0],e=t[1],_(t.length).times(function(n){return function(r){var i;return i=n.countryColors,n._setColorScale(i,t[r])}}(this)),this.x=d3.scale.linear().range([0,this.innerWidth]),this.y0=d3.scale.linear().range([this.innerHeight,0]),this.y1=d3.scale.linear().range([this.innerHeight,0]),this.xAxis=this.createAxis("x",this.x,"bottom"),this.yAxisLeft=this.createAxis("y0",this.y0,"left",{size:{major:0-this.innerWidth,minor:0-this.innerWidth,end:0-this.innerWidth}}),this.yAxisRight=this.createAxis("y1",this.y1,"right"),n=this.setCountries(this.color,i),e&&(r=this.setCountries(this.colorAlt,e)),a=[],o=[],s=[],_(i).each(function(t,n){return _(i[n]).each(function(t){return a.push(t[0]),o.push(t[1])})}),e&&e.length&&_(e).each(v,k)(function(){return _(i[k]).each(function(t){return s.push(t[1])})}),this.x.domain(d3.extent(a)),this.setDomain(this.y0,this.findMin(o),this.findMax(o)),e&&this.setDomain(this.y1,this.findMin(s),this.findMax(s)),setTimeout(function(){return $(".data-point").popover({container:"body",html:!0,trigger:"manual",placement:"top"},10)}),this.drawChart(n,r)},n.prototype.setCountries=function(t,n){return t.domain().map(function(t){return{name:t,values:n[t]}})},n.prototype.setDomain=function(t,n,r){return 0>n||n>10||(n=0),t.domain([n,r])},n.prototype.createAxis=function(t,n,r,i){var e,a;return a={count:10,subdivide:!0,padding:10,size:{major:0,minor:0,end:0}},i=_.extend(a,i||{}),e=void 0,"x"===t?e=d3.svg.axis().scale(n).orient(r):t.match(/^y/)&&(e=d3.svg.axis().scale(n).orient(r).ticks(i.count).tickSubdivide(i.subdivide).tickSize(i.size.major,i.size.minor,i.size.end).tickPadding(i.padding),this.setTickFormat(e)),e},n.prototype.findMin=function(t){return d3.min(t)},n.prototype.findMax=function(t){return d3.max(t)},n.prototype.drawLines=function(t,n,r,i,e){var a,o,s,u,c,d,h,l,p,f;return e||(e=!1),u=d3.svg.line().defined(function(t){return t?!_.isNaN(t[0])&&!_.isNaN(t[1]):void 0}).x(function(t){return n(t[0])}).y(function(t){return r(t[1])}),c=this.svg.selectAll(".countries").data(t),a=c.enter().append("g").attr("class","country"),o="data-legend"+(e?"-comparison":void 0),s="data-legend-color",a.append("path").attr("class","line").attr("d",function(t){return u(t.values)}).attr(o,function(t){return t.name}).attr(s,function(t){return i(t.name)}).style("stroke",function(t){return i(t.name)}).style("stroke-dasharray",e?"5, 5":null),h=5.2,f=1e3,d=.4,p=this.svg.append("g"),l=a.selectAll(".data-point").data(function(t){var n;return n=_.filter(t.values,function(t){return!_.isNaN(t[0])&&!_.isNaN(t[1])}),_(n).each(function(n){return n.push(t.name)}),n}),l.enter().append("circle").attr("class","data-point").style("opacity",d).attr("cx",function(t){return n(t[0])}).attr("cy",function(t){return r(t[1])}).attr("r",function(){return h}).attr("title",function(t){return t[2]}).attr("data-toggle","popover").attr("data-content",function(t){return"X: "+parseFloat(t[0],10).round2()+" <br /> Y: "+parseFloat(t[1],10).round2()}).style("fill",function(t){return i(t[2])}).on("mouseover",function(){var t;return t=$(this),t.popover("show"),d3.select(this).transition().duration(250).style("opacity",1)}).on("mouseout",function(){var t;return t=$(this),t.popover("hide"),d3.select(this).transition().duration(250).style("opacity",d)}),l[0]&&l[0][0]&&null!=l[0][0].raphaelNode?_.each(l,function(t){return _.each(t,function(t){var n,r,i;return r=t.domNode["data-content"],i=t.domNode.title,n=$("[raphaelid='"+t.raphaelNode.id+"']"),n.addClass("data-point").attr("title",i).attr("data-content",r).attr("data-toggle","popover")})}):void 0},n.prototype.drawChart=function(t,n){return this.drawAxes(t,n),this.drawLines(t,this.x,this.y0,this.color),n&&this.drawLines(n,this.x,this.y1,this.colorAlt,!0),this.drawLegend(),this.drawTitle()},n.prototype.drawAxes=function(t,n){return this.drawXAxis(),this.drawYAxis(),n?this.drawYAxis(!0):void 0},n.prototype.drawXAxis=function(){return this.svg.append("g").attr("class","x axis").attr("transform","translate(0, "+this.innerHeight+")").call(this.xAxis)},n.prototype.drawYAxis=function(t){var n,r,i,e,a,o;return t||(t=!1),a=0,t?(o=this.opts.yLabelComparisonOffset||this.margin.right/8,n=this.opts.yLabelComparison):(o=0-this.opts.yLabelOffset,n=this.opts.yLabel),e=t?"translate("+this.innerWidth+", 0)":null,i=_.str.words(n,", ")[0],_.str.words(n,", ")[1]&&(i+=","),r=this.svg.append("g").attr("class","y axis").call(t?this.yAxisRight:this.yAxisLeft).attr("transform",e).append("text").attr("transform","rotate(-90)translate("+a+", "+o+")").style("text-anchor","middle").attr("class","chart-label chart-label-y-axis"),r.append("tspan").attr("x","-160").attr("y",t?"3.2em":"-4.2em").text(),r.append("tspan").attr("x","-160").attr("y",t?"4.4em":"-3.0em").text(_.str.words(n,", ")[1])},n.prototype.buildData=function(){var t,n,r,i,e,a;return _.each(this.data,function(t){return _.map(t.data,function(n){return n.country=t.country})}),r=_.compact(_.pluck(this.data,"country")),r||(r=_.compact(_.pluck(this.data,"name"))),i=_.compact(_.flatten(_.pluck(this.data,"data"))),e=_.compact(_.flatten(_.pluck(this.data,"dataComparison"))),i=_.flatten(i),t=_.uniq(_.pluck(i,"country")),n=_.groupBy(i,function(t){return t.country}),a=function(t){return n=void 0,t&&t.length&&(n={},_(t).each(function(t){return n[t.country]?n[t.country].push([t.xValue,t.yValue]):n[t.country]=[[t.xValue,t.yValue]]})),n},[a(i),a(e)]},n}(ChartBuilder)}).call(this);